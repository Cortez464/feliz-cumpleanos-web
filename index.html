<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>¬°Una Sorpresa para Ti! ‚ù§Ô∏è</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Librer√≠a de Confeti Profesional -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto:wght@300;400;700&family=Share+Tech+Mono&display=swap');

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      font-family: 'Roboto', sans-serif;
      overflow-x: hidden;
      color: white;
    }

    @keyframes gradient {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    /* PANTALLA DE INICIO (Caja) */
    #welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
      transition: all 0.8s ease-out;
    }

    .gift-box {
      font-size: 100px;
      cursor: pointer;
      user-select: none;
      transition: transform 0.1s;
    }

    /* Animaciones de Suspenso */
    .shake-mild { animation: shake 0.5s; }
    .shake-hard { animation: shake 0.5s infinite; color: #ff69b4; }
    .shake-error { animation: shake 0.3s; border-color: red !important; }
    
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      10% { transform: translate(-1px, -2px) rotate(-1deg); }
      20% { transform: translate(-3px, 0px) rotate(1deg); }
      30% { transform: translate(3px, 2px) rotate(0deg); }
      40% { transform: translate(1px, -1px) rotate(1deg); }
      50% { transform: translate(-1px, 2px) rotate(-1deg); }
      60% { transform: translate(-3px, 1px) rotate(0deg); }
      70% { transform: translate(3px, 1px) rotate(-1deg); }
      80% { transform: translate(-1px, -1px) rotate(1deg); }
      90% { transform: translate(1px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -2px) rotate(-1deg); }
    }

    /* Input de Contrase√±a Estilo Hacker */
    #password-container {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
      animation: fadeIn 0.5s;
    }

    .hacker-input {
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid #00ff00;
      color: #00ff00;
      font-family: 'Share Tech Mono', monospace;
      padding: 10px 15px;
      border-radius: 5px;
      text-align: center;
      font-size: 1.2rem;
      outline: none;
      width: 250px;
      letter-spacing: 2px;
    }

    .hacker-input::placeholder {
      color: rgba(0, 255, 0, 0.5);
    }

    .hacker-btn {
      margin-top: 15px;
      background: #00ff00;
      color: black;
      font-family: 'Share Tech Mono', monospace;
      padding: 8px 20px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      border-radius: 3px;
    }

    .hacker-btn:hover { background: #00cc00; }

    /* CONTENIDO PRINCIPAL */
    #main-content {
      display: none; /* Se activa con JS */
      opacity: 0;
      transition: opacity 2s ease-in;
    }

    .container {
      text-align: center;
      padding: 30px;
      max-width: 800px;
      margin: 40px auto;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    h1 {
      font-family: 'Dancing Script', cursive;
      font-size: clamp(3rem, 6vw, 5rem);
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    /* Video Container */
    .video-wrapper {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
      margin: 30px 0;
      background: black;
    }
    
    iframe { width: 100%; height: 100%; }

    /* Efecto de M√°quina de Escribir */
    #love-letter {
      font-size: 1.25rem;
      line-height: 1.8;
      min-height: 100px; /* Evita saltos de layout */
    }
    
    .cursor::after {
      content: '|';
      animation: blink 1s infinite;
    }
    
    @keyframes blink { 50% { opacity: 0; } }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <!-- PANTALLA 1: SUSPENSO Y SEGURIDAD -->
  <div id="welcome-screen">
    <div id="gift-icon" class="gift-box" onclick="gestionarClics()">üéÅ</div>
    
    <!-- Mensaje cambiante -->
    <p id="status-msg" class="text-white text-xl mt-6 font-light tracking-widest uppercase text-center px-4">
      Tienes un regalo pendiente...
    </p>
    <p id="hint-msg" class="text-white text-xs mt-2 opacity-50">(Haz clic para abrir)</p>

    <!-- INPUT DE CONTRASE√ëA (Oculto al inicio) -->
    <div id="password-container">
      <p class="text-green-400 font-mono text-sm mb-2">> INGRESE PROTOCOLO DE BODA</p>
      <input type="text" id="wedding-date" class="hacker-input" placeholder="DD-MM-AAAA">
      <button onclick="verificarPassword()" class="hacker-btn">DESENCRIPTAR</button>
      <p id="error-msg" class="text-red-500 font-mono text-xs mt-2 h-4"></p>
    </div>
  </div>

  <!-- PANTALLA 2: EL SHOW -->
  <div id="main-content">
    <div class="container mx-auto px-4">
      <h1>¬°Feliz Cumplea√±os!</h1>
      <h2 class="text-3xl font-light mb-6">Mi esposa amada ‚ù§Ô∏è</h2>
      
      <!-- Aqu√≠ se escribir√° el texto autom√°ticamente -->
      <p id="love-letter" class="mb-8 font-light"></p>

      <!-- VIDEO -->
      <div class="video-wrapper">
        <iframe 
          id="video-frame" 
          src="https://drive.google.com/file/d/1s5cP8TqO7SEDR-95qC9w0on92g3BOUyT/preview" 
          frameborder="0"
          allow="autoplay; fullscreen"
          allowfullscreen>
        </iframe>
      </div>

      <button onclick="lanzarConfetti()" class="mt-4 px-8 py-3 bg-white text-pink-600 font-bold rounded-full shadow-lg hover:scale-110 transition transform">
        üéâ ¬°TE AMO! üéâ
      </button>
    </div>
  </div>

  <!-- M√öSICA DE FONDO -->
  <audio id="bg-music" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mp3">
  </audio>

  <script>
    /* ================= L√ìGICA DE SUSPENSO ================= */
    let clicCount = 0;
    const giftIcon = document.getElementById('gift-icon');
    const statusMsg = document.getElementById('status-msg');
    const hintMsg = document.getElementById('hint-msg');
    const passwordContainer = document.getElementById('password-container');

    function gestionarClics() {
      if (clicCount >= 3) return;

      clicCount++;

      if (clicCount === 1) {
        giftIcon.classList.remove('bounce'); 
        void giftIcon.offsetWidth; 
        giftIcon.classList.add('shake-mild');
        statusMsg.innerText = "Acceso restringido. Protocolo de seguridad activo.";
        
      } else if (clicCount === 2) {
        giftIcon.classList.remove('shake-mild');
        void giftIcon.offsetWidth;
        giftIcon.classList.add('shake-hard');
        statusMsg.innerText = "¬°ALERTA! Se requiere autenticaci√≥n manual.";
        statusMsg.style.color = "#ff69b4";
        statusMsg.classList.add('font-bold');

      } else if (clicCount === 3) {
        mostrarPasswordInput();
      }
    }

    function mostrarPasswordInput() {
      giftIcon.style.cursor = "default";
      giftIcon.classList.remove('shake-hard');
      statusMsg.innerText = "SISTEMA BLOQUEADO";
      statusMsg.style.color = "#00ff00"; 
      statusMsg.style.fontFamily = "'Share Tech Mono', monospace";
      hintMsg.style.display = 'none';
      passwordContainer.style.display = 'flex';
    }

    function verificarPassword() {
      const input = document.getElementById('wedding-date');
      const errorMsg = document.getElementById('error-msg');
      const val = input.value.trim();

      if (val === '28092025') {
        abrirRegaloDefinitivo();
      } else {
        input.classList.add('shake-error');
        input.style.borderColor = "red";
        errorMsg.innerText = "ACCESO DENEGADO: Fecha incorrecta";
        setTimeout(() => {
          input.classList.remove('shake-error');
          input.style.borderColor = "#00ff00";
          errorMsg.innerText = "";
        }, 1000);
      }
    }

    function abrirRegaloDefinitivo() {
      const audio = document.getElementById('bg-music');
      
      // Reproducimos la m√∫sica inicialmente
      audio.volume = 0.5;
      audio.play().catch(e => console.log("Audio play error:", e));

      // 1. Iniciamos el "Monitor de Foco" (Soluci√≥n de pensamiento cr√≠tico)
      // Como el iframe est√° en otro dominio, no podemos escuchar el evento "play".
      // Pero s√≠ podemos saber si el usuario hizo clic dentro del iframe (focus).
      monitorVideoInteraction(audio);

      const welcomeScreen = document.getElementById('welcome-screen');
      welcomeScreen.style.transform = 'scale(1.5)';
      welcomeScreen.style.opacity = '0';
      
      setTimeout(() => {
        welcomeScreen.style.display = 'none';
        const mainContent = document.getElementById('main-content');
        mainContent.style.display = 'block';
        
        setTimeout(() => {
          mainContent.style.opacity = '1';
          typeWriter();
          lanzarConfetti();
        }, 100);
      }, 800);
    }

    // --- NUEVA FUNCI√ìN PARA DETECTAR INTERACCI√ìN CON EL VIDEO ---
    function monitorVideoInteraction(audioElement) {
      const videoFrame = document.getElementById('video-frame');
      
      // Chequeo constante cada 500ms
      const intervalId = setInterval(() => {
        // Si el elemento activo del navegador es el iframe, el usuario le dio click
        if (document.activeElement === videoFrame) {
          console.log("Usuario interactu√≥ con el video. Deteniendo m√∫sica de fondo.");
          audioElement.pause();
          clearInterval(intervalId); // Dejamos de monitorear para ahorrar recursos
        }
      }, 500);
    }

    /* ================= M√ÅQUINA DE ESCRIBIR ================= */
    const textToType = "Hoy celebro tu vida, tu risa y cada momento juntos. Eres mi roca, mi alegr√≠a y mi mejor amiga. Espero que este video te recuerde lo mucho que te adoro. ¬°Gracias por existir!";
    const speed = 50; 
    let i = 0;

    function typeWriter() {
      if (i < textToType.length) {
        document.getElementById("love-letter").innerHTML += textToType.charAt(i);
        i++;
        setTimeout(typeWriter, speed);
      } else {
        document.getElementById("love-letter").classList.remove("cursor");
      }
    }

    /* ================= CONFETI ================= */
    function lanzarConfetti() {
      var duration = 3 * 1000;
      var animationEnd = Date.now() + duration;
      var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
      var randomInRange = (min, max) => Math.random() * (max - min) + min;

      var interval = setInterval(function() {
        var timeLeft = animationEnd - Date.now();
        if (timeLeft <= 0) return clearInterval(interval);
        var particleCount = 50 * (timeLeft / duration);
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
      }, 250);
    }
  </script>
</body>
</html>
